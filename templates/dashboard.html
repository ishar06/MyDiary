{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block sidebar %}
<div class="p-3">
    <form class="mb-4" action="{{ url_for('search_entries') }}" method="GET">
        <div class="mb-3">
            <input type="text" name="q" class="form-control" placeholder="Search entries...">
        </div>
        <div class="mb-3">
            <input type="date" name="date" class="form-control">
        </div>
        <div class="mb-3">
            <select name="mood" class="form-select">
                <option value="">Filter by mood</option>
                <option value="happy">Happy 😊</option>
                <option value="sad">Sad 😢</option>
                <option value="angry">Angry 😠</option>
                <option value="excited">Excited 🤩</option>
                <option value="neutral">Neutral 😐</option>
            </select>
        </div>
        <div class="d-grid">
            <button type="submit" class="btn btn-secondary">Search</button>
        </div>
    </form>

    <h5>Past Entries</h5>
    <div class="list-group">
        {% for entry in entries %}
        <a href="{{ url_for('view_entry', entry_id=entry.id) }}" 
           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            {{ entry.title }}
            <span class="mood-emoji">
                {% if entry.mood == 'happy' %}😊
                {% elif entry.mood == 'sad' %}😢
                {% elif entry.mood == 'angry' %}😠
                {% elif entry.mood == 'excited' %}🤩
                {% else %}😐
                {% endif %}
            </span>
        </a>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container py-4">
    <h2>New Entry</h2>
    <form method="POST" action="{{ url_for('new_entry') }}" id="entryForm">
        {{ form.csrf_token }}
        <div class="mb-3">
            {{ form.title.label(class="form-label") }}
            {{ form.title(class="form-control", value=today_date) }}
        </div>
        <div class="mb-3">
            {{ form.mood.label(class="form-label") }}
            {{ form.mood(class="form-select") }}
        </div>
        <div class="mb-3">
            {{ form.content.label(class="form-label") }}
            <div id="editor">{{ form.content.data or '' }}</div>
            {{ form.content(style="display: none;") }}
        </div>
        <button type="submit" class="btn btn-primary">Save Entry</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Initialize Quill editor
    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                ['bold', 'italic'],
                [{ 'size': ['small', false, 'large', 'huge'] }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['clean']
            ]
        }
    });

    // Set today's date as default title if no title is set
    document.addEventListener('DOMContentLoaded', function() {
        var titleInput = document.querySelector('#title');
        if (!titleInput.value) {
            var today = new Date();
            titleInput.value = today.toLocaleDateString();
        }
    });

    // Update hidden content field before form submission
    document.querySelector('#entryForm').addEventListener('submit', function() {
        var contentInput = document.querySelector('#content');
        contentInput.value = quill.root.innerHTML;
    });
</script>
{% endblock %}