{% extends "base.html" %}

{% block title %}{{ entry.title }}{% endblock %}

{% block sidebar %}
<div class="p-3">
    <h5>Past Entries</h5>
    <div class="list-group">
        {% for entry in entries %}
        <a href="{{ url_for('view_entry', entry_id=entry.id) }}" 
           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            {{ entry.title }}
            <span class="mood-emoji">
                {% if entry.mood == 'happy' %}üòä
                {% elif entry.mood == 'sad' %}üò¢
                {% elif entry.mood == 'angry' %}üò†
                {% elif entry.mood == 'excited' %}ü§©
                {% else %}üòê
                {% endif %}
            </span>
        </a>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Edit Entry</h2>
        <div class="text-muted">{{ entry.date.strftime('%Y-%m-%d %H:%M') }}</div>
    </div>

    <form method="POST" action="{{ url_for('edit_entry', entry_id=entry.id) }}" id="entryForm">
        {{ form.csrf_token }}
        <div class="mb-3">
            {{ form.title.label(class="form-label") }}
            {{ form.title(class="form-control", value=entry.title) }}
        </div>
        <div class="mb-3">
            {{ form.mood.label(class="form-label") }}
            {{ form.mood(class="form-select") }}
        </div>
        <div class="mb-3">
            {{ form.content.label(class="form-label") }}
            <div id="editor">{{ entry.content | safe }}</div>
            {{ form.content(style="display: none;") }}
        </div>
        <button type="submit" class="btn btn-primary">Update Entry</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Initialize Quill editor
    var quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                ['bold', 'italic'],
                [{ 'size': ['small', false, 'large', 'huge'] }],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['clean']
            ]
        }
    });

    // Update hidden content field before form submission
    document.querySelector('#entryForm').addEventListener('submit', function() {
        var contentInput = document.querySelector('#content');
        contentInput.value = quill.root.innerHTML;
    });
</script>
{% endblock %}